<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1DAY - デイリータスク管理</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // アイコンコンポーネント
        const Plus = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 5v14M5 12h14"/>
            </svg>
        );
        
        const Check = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M20 6L9 17l-5-5"/>
            </svg>
        );
        
        const X = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
        );
        
        const Edit2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4Z"/>
            </svg>
        );
        
        const RotateCcw = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
            </svg>
        );
        
        const Calendar = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        );
        
        const Flame = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>
            </svg>
        );
        
        const Target = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="6"/>
                <circle cx="12" cy="12" r="2"/>
            </svg>
        );

        const DailyTaskApp = () => {
            const [tasks, setTasks] = useState(() => {
                const saved = localStorage.getItem('1day-tasks');
                return saved ? JSON.parse(saved) : [];
            });
            const [newTask, setNewTask] = useState('');
            const [editingId, setEditingId] = useState(null);
            const [editText, setEditText] = useState('');
            const [currentDate, setCurrentDate] = useState(new Date().toDateString());
            const [streak, setStreak] = useState(() => {
                const saved = localStorage.getItem('1day-streak');
                return saved ? JSON.parse(saved) : {};
            });

            // データを保存
            useEffect(() => {
                localStorage.setItem('1day-tasks', JSON.stringify(tasks));
            }, [tasks]);

            useEffect(() => {
                localStorage.setItem('1day-streak', JSON.stringify(streak));
            }, [streak]);

            // 日付が変わったかチェック
            useEffect(() => {
                const checkDateChange = () => {
                    const today = new Date().toDateString();
                    if (today !== currentDate) {
                        handleDayChange();
                        setCurrentDate(today);
                    }
                };

                const interval = setInterval(checkDateChange, 60000);
                checkDateChange();

                return () => clearInterval(interval);
            }, [currentDate]);

            // 日付変更時の処理
            const handleDayChange = () => {
                const newStreak = { ...streak };
                tasks.forEach(task => {
                    if (task.completed) {
                        newStreak[task.id] = (newStreak[task.id] || 0) + 1;
                    } else {
                        newStreak[task.id] = 0;
                    }
                });
                setStreak(newStreak);

                setTasks(tasks.map(task => ({
                    ...task,
                    completed: false,
                    completedAt: null
                })));
            };

            // 手動リセット
            const resetDay = () => {
                if (window.confirm('今日のタスクをリセットしますか？')) {
                    setTasks(tasks.map(task => ({
                        ...task,
                        completed: false,
                        completedAt: null
                    })));
                }
            };

            // タスクを追加
            const addTask = () => {
                if (newTask.trim()) {
                    const task = {
                        id: Date.now(),
                        text: newTask.trim(),
                        completed: false,
                        createdAt: new Date().toLocaleDateString('ja-JP'),
                        completedAt: null,
                        isDaily: true
                    };
                    setTasks([...tasks, task]);
                    setNewTask('');
                    setStreak({ ...streak, [task.id]: 0 });
                }
            };

            // タスクの完了状態を切り替え
            const toggleTask = (id) => {
                setTasks(tasks.map(task => 
                    task.id === id 
                        ? { 
                            ...task, 
                            completed: !task.completed,
                            completedAt: !task.completed ? new Date().toLocaleTimeString('ja-JP', {
                                hour: '2-digit',
                                minute: '2-digit'
                            }) : null
                        }
                        : task
                ));
            };

            // タスクを削除
            const deleteTask = (id) => {
                if (window.confirm('このタスクを削除しますか？')) {
                    setTasks(tasks.filter(task => task.id !== id));
                    const newStreak = { ...streak };
                    delete newStreak[id];
                    setStreak(newStreak);
                }
            };

            // タスクの編集を開始
            const startEdit = (id, text) => {
                setEditingId(id);
                setEditText(text);
            };

            // タスクの編集を保存
            const saveEdit = () => {
                if (editText.trim()) {
                    setTasks(tasks.map(task => 
                        task.id === editingId 
                            ? { ...task, text: editText.trim() }
                            : task
                    ));
                }
                setEditingId(null);
                setEditText('');
            };

            // 編集をキャンセル
            const cancelEdit = () => {
                setEditingId(null);
                setEditText('');
            };

            // 統計
            const stats = {
                total: tasks.length,
                completed: tasks.filter(t => t.completed).length,
                completionRate: tasks.length > 0 ? Math.round((tasks.filter(t => t.completed).length / tasks.length) * 100) : 0
            };

            // 時間表示
            const [currentTime, setCurrentTime] = useState(new Date());
            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            // Enterキーでタスク追加
            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    addTask();
                }
            };

            // 編集時のEnterキー
            const handleEditKeyPress = (e) => {
                if (e.key === 'Enter') {
                    saveEdit();
                } else if (e.key === 'Escape') {
                    cancelEdit();
                }
            };

            // 次の0時までの時間を計算
            const getTimeUntilMidnight = () => {
                const now = new Date();
                const midnight = new Date();
                midnight.setHours(24, 0, 0, 0);
                const diff = midnight - now;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                return `${hours}時間${minutes}分`;
            };

            return (
                <div className="min-h-screen bg-gray-50 p-4">
                    <div className="max-w-4xl mx-auto">
                        {/* ヘッダー */}
                        <div className="text-center mb-6">
                            <h1 className="text-4xl font-bold text-gray-900 mb-2">1DAY</h1>
                            <div className="text-lg font-medium text-gray-700">
                                {currentTime.toLocaleDateString('ja-JP', { 
                                    year: 'numeric', 
                                    month: 'long', 
                                    day: 'numeric',
                                    weekday: 'long' 
                                })}
                            </div>
                            <div className="text-sm text-gray-500">
                                リセットまで: {getTimeUntilMidnight()}
                            </div>
                        </div>

                        {/* タスク追加フォーム */}
                        <div className="bg-white rounded-xl p-6 shadow-md border border-gray-200 mb-6">
                            <div className="flex flex-col md:flex-row gap-4">
                                <input
                                    type="text"
                                    value={newTask}
                                    onChange={(e) => setNewTask(e.target.value)}
                                    onKeyPress={handleKeyPress}
                                    placeholder="新しいデイリータスクを追加..."
                                    className="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all"
                                />
                                <div className="flex gap-2">
                                    <button
                                        onClick={addTask}
                                        className="bg-gray-800 hover:bg-gray-900 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors font-medium"
                                    >
                                        <Plus size={20} />
                                        追加
                                    </button>
                                    <button
                                        onClick={resetDay}
                                        className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg flex items-center gap-2 transition-colors"
                                        title="今日のタスクをリセット"
                                    >
                                        <RotateCcw size={20} />
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* 進捗バー */}
                        {tasks.length > 0 && (
                            <div className="bg-white rounded-xl p-3 shadow-md border border-gray-200 mb-4">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-xs font-medium text-gray-700">進捗: {stats.completed}/{stats.total}</span>
                                    <span className="text-xs text-gray-500">{stats.completionRate}%</span>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-2">
                                    <div 
                                        className="bg-gray-800 h-2 rounded-full transition-all duration-500"
                                        style={{ width: `${stats.completionRate}%` }}
                                    ></div>
                                </div>
                            </div>
                        )}

                        {/* タスクリスト */}
                        <div className="space-y-3">
                            {tasks.length === 0 ? (
                                <div className="bg-white rounded-xl p-12 shadow-md border border-gray-200 text-center">
                                    <div className="text-gray-400 text-6xl mb-4">□</div>
                                    <h3 className="text-xl font-medium text-gray-700 mb-2">デイリータスクを追加</h3>
                                    <p className="text-gray-500">
                                        毎日継続したい習慣やタスクを追加してください。<br />
                                        24時になると自動的にリセットされます。
                                    </p>
                                </div>
                            ) : (
                                tasks.map(task => (
                                    <div
                                        key={task.id}
                                        className={`bg-white rounded-xl p-4 shadow-md border transition-all hover:shadow-lg ${
                                            task.completed ? 'border-gray-400 bg-gray-50' : 'border-gray-200'
                                        }`}
                                    >
                                        <div className="flex items-center gap-4">
                                            {/* 完了チェックボックス */}
                                            <button
                                                onClick={() => toggleTask(task.id)}
                                                className={`w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all transform hover:scale-105 ${
                                                    task.completed
                                                        ? 'bg-gray-800 border-gray-800 text-white shadow-md'
                                                        : 'border-gray-300 hover:border-gray-600 hover:bg-gray-50'
                                                }`}
                                            >
                                                {task.completed && <Check size={20} />}
                                            </button>

                                            {/* タスク内容 */}
                                            <div className="flex-1">
                                                {editingId === task.id ? (
                                                    <input
                                                        type="text"
                                                        value={editText}
                                                        onChange={(e) => setEditText(e.target.value)}
                                                        onKeyPress={handleEditKeyPress}
                                                        onBlur={saveEdit}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-transparent"
                                                        autoFocus
                                                    />
                                                ) : (
                                                    <div>
                                                        <div className="flex items-center gap-3 mb-1">
                                                            <span
                                                                className={`text-lg font-medium ${
                                                                    task.completed ? 'line-through text-gray-500' : 'text-gray-800'
                                                                }`}
                                                            >
                                                                {task.text}
                                                            </span>
                                                            {streak[task.id] > 0 && (
                                                                <div className="flex items-center gap-1 bg-gray-200 text-gray-800 px-2 py-1 rounded-full text-xs font-medium">
                                                                    <Flame size={12} />
                                                                    {streak[task.id]}日連続
                                                                </div>
                                                            )}
                                                        </div>
                                                        <div className="flex items-center gap-4 text-xs text-gray-500">
                                                            <div className="flex items-center gap-1">
                                                                <Calendar size={12} />
                                                                作成: {task.createdAt}
                                                            </div>
                                                            {task.completedAt && (
                                                                <div className="flex items-center gap-1 text-gray-600">
                                                                    <Check size={12} />
                                                                    完了: {task.completedAt}
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>

                                            {/* アクションボタン */}
                                            <div className="flex items-center gap-2">
                                                {editingId === task.id ? (
                                                    <>
                                                        <button
                                                            onClick={saveEdit}
                                                            className="p-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
                                                        >
                                                            <Check size={16} />
                                                        </button>
                                                        <button
                                                            onClick={cancelEdit}
                                                            className="p-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
                                                        >
                                                            <X size={16} />
                                                        </button>
                                                    </>
                                                ) : (
                                                    <>
                                                        <button
                                                            onClick={() => startEdit(task.id, task.text)}
                                                            className="p-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
                                                        >
                                                            <Edit2 size={16} />
                                                        </button>
                                                        <button
                                                            onClick={() => deleteTask(task.id)}
                                                            className="p-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
                                                        >
                                                            <X size={16} />
                                                        </button>
                                                    </>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>

                        {/* フッター */}
                        <div className="text-center mt-8 space-y-2">
                            <p className="text-gray-500 text-sm">
                                毎日24時にタスクが自動リセットされます
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<DailyTaskApp />, document.getElementById('root'));
    </script>
</body>
</html>
